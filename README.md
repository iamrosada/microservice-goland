# Microservice Readme

## Описание

Данный микросервис на языке программирования Golang предназначен для создания и применения промокодов к пользователям. Взаимодействие с данным сервисом предполагает работу с другим сервисом, отвечающим за хранение и управление пользователями.

## Технологии

1. **Язык программирования**: Golang
2. **Фреймворк**: Gin (для обработки HTTP-запросов)
3. **ORM**: Gorm (для взаимодействия с базой данных PostgreSQL)
4. **База данных**: PostgreSQL
5. **Логирование**: Вывод на стандартный поток ввода (stdin)

## Доступные API стороннего сервиса пользователей

### Получение доступных пользователей для применения промокода

**Endpoint**: `GET api/users/promo_type/:type/available`

**Respons**:

```json
{
  "user_id": [1, 5, 7, 9]
}
```

### Получение пользователей, к которым применен промокод

**Endpoint**: `GET api/users/promo/:id/applied`

**Respons**:

```json
{
  "users_id": [1, 2, 3, 4]
}
```

### Применение промокода к пользователям

**Endpoint**: `POST api/users/promo/:id/apply`

**Request**:

```json
{
  "users_id": [1, 2, 6, 9]
}
```

**Response status**: "ok"

## Контракт API микросервиса

### Проверка работоспособности

**Endpoint**: `GET /check_alive`

**Response status**: 200

### Создание промокода

**Endpoint**: `POST /promo/create`

**Request**:

```json
{
  "name": "Новое промо",
  "slug": "new promo",
  "url": "https://www.example.com/promo",
  "description": "Воспользуйтесь нашим новым промокодом. Вам понравится.",
  "type": 1
}
```

### Добавление промокодов к промо

**Endpoint**: `POST /promo/:id/codes`

**Request**:

```json
{
  "codes": ["123", "456", "789"]
}
```

### Получение промо с промокодами

**Endpoint**: `GET /promo/:id`

### Применение промо ко всем подходящим пользователям

**Endpoint**: `POST /promo/:id/apply_all`

### Применение промо к указанным пользователям

**Endpoint**: `POST /promo/:id/apply_users`

**Request**:

```json
{
  "users_id": [1, 4, 8]
}
```

### Получение пользователей, для которых применен промокод

**Endpoint**: `GET /promo/:id/users`

**Response**:

```json
{
  "users_id": [1, 3, 6, 8]
}
```

## Запуск микросервиса

Для запуска микросервиса выполните следующие шаги:

1. **Склонируйте репозиторий:**

   ```bash
   git clone https://github.com/iamrosada/microservice-goland
   ```

2. **Перейдите в директорию микросервиса:**

   ```bash
   cd microservice-goland
   ```

3. **Запустите сервис пользователей:**
   Сервис пользователей будет доступен на порту 8000.

   ```bash
   cd user-service
   go run main.go
   ```

4. **Откройте новый терминал и запустите сервис промоции:**
   Сервис promo-service будет доступен на порту 8080.

   ```bash
   cd /promo-service
   go run main.go
   ```

После выполнения этих шагов, микросервис будет доступен по указанным вами эндпоинтам. Убедитесь, что у вас установлен Go на вашей системе перед выполнением этих команд.
